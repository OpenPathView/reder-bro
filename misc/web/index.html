<!DOCTYPE html>
<html>
<head>
    <title>WebSocket test</title>
    <script type="text/javascript">

        var qs = function(s){
            return document.querySelector(s);
        };

        var ws = new function(){
            this.ws = null;
            this.openSocket = function(){
                this.ws = new WebSocket(qs("#ws_url").value, "protocolOne");
                this.ws.onopen = function(e){
                    console.log("WebSocket opened, event :");
                    console.log(e);
                };
                var that = this;
                window.onbeforeunload = function(){
                    that.close();
                    alert("close");
                };
                this.ws.onmessage = function(e){
                    var rep = JSON.parse(e.data);
                    console.log( rep );
            
                    if( rep.hasOwnProperty('error') ){
                        switch(rep.error){
                            case 0:
                                alert("Pb de pseudo");
                            break;
                            case 1:
                                alert("erreur 1");
                            case 2:
                            default:
                                alert("Autre erreur");
                        }
                        return;
                    }
            
                    if( rep.status == "login"){
                        qs("#status").innerHTML="Connecté";
                    }
                };
            };
            this.login = function(){
                var data = { username: qs("#pseudo").value+","+qs("#couleur").value};
                console.log(data);
                this.ws.send( JSON.stringify(data) );
            };
            this.msg = function(){
                var data = { msg: qs("#msg").value };
                console.log(data);
                this.ws.send( JSON.stringify(data) );
            };
            this.close = function(){
                this.ws.close();
            };
        }();
    
    </script>
</head>

<body>

    <label>URL du ws : <input type="text" id="ws_url" value="ws://localhost:9876/"></label>
    <button onclick="ws.openSocket()">Open connexion</button><br>
    <label>Pseudo : <input type="text" id="pseudo"></label>
    <label>Couleur : <input type="text" id="couleur"></label>
    <button onclick="ws.login()">Définir le pseudo</button>

    <br><br>
    <label>Message : <input type="text" id="msg"></label>
    <button onclick="ws.msg()">Message</button>

    <br><br>
    <span id="status"></span>

</body>
</html>